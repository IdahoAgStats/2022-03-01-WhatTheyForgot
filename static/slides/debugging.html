<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Debugging</title>
    <meta charset="utf-8" />
    <meta name="author" content="Julia Piaskowski" />
    <meta name="date" content="2022-03-08" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Debugging
## âš”<br/>in R
### Julia Piaskowski
### 2022-03-08

---




# When you encounter an R error: 

1. check package documentation
1. ask around: RStudio community, R4DS slack, Stack Overflow, your local oracle
1. check source code

##### but, eventually, you will probably need to work with debugging functions

---
class: center, middle, inverse

## debugging = removing code errors  
&lt;br&gt; 
# How do you debug?  

---
# Retrace your steps

1. Go through a process step-by-step and see where things went wrong
1. Start with the action that occurred that first and proceed to the second action, the third, etc...

---
# Retrace Example

[Agricultural Data from Tidy Tuesday](https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-09-01)

```r
# install.packages"(tidytuesdayR")
library(dplyr); library(tidyr); library(purrr)
agdata &lt;- tidytuesdayR::tt_load('2020-09-01')
yields &lt;- agdata[[4]]
colnames(yields) &lt;- gsub("\\(tonnes per hectare\\)", "", names(yields))

wheat &lt;- yields %&gt;% tidyr::pivot_wider(id_cols = Year, 
                                  names_from = Entity,
                                  values_from = Wheat) %&gt;% 
  purrr::discard(~all(is.na(.))) %&gt;% 
  mutate(ethiopia = case_when(
    is.na(Ethiopia) ~ `Ethiopia PDR`,
    TRUE ~ Ethiopia)) %&gt;% select(-Ethiopia, -`Ethiopia PDR`)
```
---
# Another retrace example

#### Hard: 

```r
result &lt;- function4(function3(function2(function1(my_object, extra_args = 1), more_args = TRUE), even_more_args = "show_me_the_money"), final_arg = FALSE)
```
--
#### Easier

```r
pre_result1 &lt;- function1(my_object, extra_args = 1)
pre_result2 &lt;- function2(pre_result1, more_args = TRUE)
pre_result3 &lt;- function3(pre_result2, even_more_args = "show_me_the_money")
result &lt;- function4(pre_result3, final_arg = FALSE)
```
*(avoid writing nested functions)*  

---
# Consider writing a function if....

* You need to do something repeatedly
* that thing that needs to be repeated has several steps
* If you have to cut-paste-replace more than twice, consider a function to automate that process


---
# Why write functions? 

* To save yourself work  
* to avoid mistakes  
  
:thumbs-up: DRY = **D**on't **R**epeat **Y**ourself  
&lt;br&gt;
  
:thumbs-down: WET = **W**rite **E**verything **T**wice / **We** **E**njoy **T**yping  

---
# Crash course in functions

R functions follow a general structure:


```r
my_function_name &lt;- function(arg1, arg2) {
  final_output &lt;- action(arg1, arg2)
  return(final_output)
}
```

Their usage:

```r
my_result &lt;- my_function_name(arg1 = ..., arg2 = ...)
```

---
# More intro to functions

It helps to describe the arguments (but, first we need an actual function to help us define the argument)

```r
my_function_name &lt;- function(arg1, arg2) {
  # arg1 &amp; arg2 = numeric vectors of identical lengths
  plot(arg1, arg2)
}
```


```r
plot(1:10, 1:10 + rnorm(10))
```

![](debugging_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;
 *(usually these functions are slightly more complicated)* 

---
class: middle, center, inverse

# [exercise](exercises/exercise-4.html)

---





---
# Some future example


```r
fertil &lt;- agdata[[2]]
colnames(fertil) &lt;- c("country", "code", "year", 
                      "cereal_yield", "N_appl")
anova
```

---
class: center, middle, inverse

# Miscellaneous R tip: running R scripts in a terminal

```r
Rscript path/to/my/script.R 
```


```bash
Rscript -e "Sys.Date()"
```

```
## [1] "2022-03-07"
```




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

  </body>
</html>
